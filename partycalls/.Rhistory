record_of_pvals <- list()
while (counter <= count_min |
(counter < count_max & match_counter < match_count_min)) {
counter <- counter + 1
record_of_coding[[counter]] <- noncalls
old_noncalls <- noncalls
old_switched_votes <- switched_votes
pvals <- code_party_calls_1step(rc, DT, noncalls)
record_of_pvals[[counter]] <- pvals
noncalls <- which(pvals > pval_threshold)
calls <- setdiff(seq_len(rc$m), old_noncalls)
if (sim_annealing == TRUE) {
n_random_switches <- floor(rc$m * .2 * max(0, 1 - counter / 50) ^ 2)
} else {
n_random_switches <- 0
}
if (n_random_switches > 0) {
calls_to_switch <- sample(calls, n_random_switches)
noncalls_to_switch <- sample(noncalls, n_random_switches)
calls_to_keep <- setdiff(calls, calls_to_switch)
noncalls_to_keep <- setdiff(noncalls, noncalls_to_switch)
calls <- c(calls_to_keep, noncalls_to_switch)
noncalls <- c(noncalls_to_keep, calls_to_switch)
}
switched_votes <- symdiff(noncalls, old_noncalls)
if (length(switched_votes) <= vote_switch_percent * rc$m) {
match_counter <- match_counter + 1
} else {
match_counter <- 0
}
cat("Iteration", counter, "had", length(switched_votes), "out of", rc$m,
"switched votes\n")
}
rc$party_calls <- seq_len(rc$m)[-noncalls]
rc$record_of_coding <- record_of_coding
rc$record_of_pvals <- record_of_pvals
rc
}
# test functions with data
code_party_calls(rc = h093)
devtools::document()
devtools::build()
devtools::install()
code_party_calls(h093)
library(partycalls)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
h112 <- pscl::readKH("inst/extdata/hou112kh.ord")
code_party_calls(h093)
devtools::document()
devtools::build()
devtools::install()
devtools::document()
devtools::build()
devtools::install()
devtools::document()
devtools::build()
devtools::install()
library(partycalls)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
code_party_calls(h093)
devtools::document()
devtools::build()
devtools::install()
library(partycalls)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
h112 <- pscl::readKH("inst/extdata/hou112kh.ord")
set.seed(1584882915)
code_party_calls_by_congress_number <- function(congress_number)
{
cat("**** working on house", congress_number, "\n")
rc <- get(paste0("h", sprintf("%03.f", congress_number)))
code_party_calls(rc)
}
house_party_calls <- lapply(93:112, code_party_calls_by_congress_number)
# load data
options(stringsAsFactors = FALSE)
library(partycalls)
library(pscl)
library(emIRT)
library(data.table)
load("inst/extdata/houKHfiles001-111.rdata")
?`%in%
`
%in%
`%in%`
?%in%
?`%in%`
rc <- h093
devtools::document()
devtools::build()
devtools::install()
devtools::document()
devtools::build()
devtools::install()
library(partycalls)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
h112 <- pscl::readKH("inst/extdata/hou112kh.ord")
code_party_calls(h093)
library(partycalls)
library(data.table)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
h111_test <- h111
h111_test <- pscl::dropRollCall(h111_test,
dropList = alist(dropLegis = state == "USA"))
h111_test <- emIRT::convertRC(h111_test, type = "binIRT")
h111_test$votes
DT_test <- CJ(vt = colnames(h111_test$votes), mc = rownames(h111_test$votes),
sorted = FALSE)
DT_test$y <- as.vector(h111_test$votes)
DT_test$party <- h111_test$legis.data$party
DT_test[y %in% c(0, 9), y:= NA]
DT_test[y == -1, y:= 0]
View(DT_test)
DT_test[, yea_perc := mean(y, na.rm = TRUE), by = vt]
noncall_test <- subset(DT_test, yea_perc < 0.65 & yea_perc > 0.35, select = vt)
noncall_test <- c(unique(noncall_test$vt))
noncall_test <-
as.numeric(c(gsub(pattern = "Vote ", replacement = "", noncall_test)))
rc_test_SD <- data.table(party = c("D", "D", "R", "D", "R"), y = c(1, 0, 1, 0, 1))
length(unique(rc_test_SD[!is.na(y) & party %in% c("D", "R"), y]))
length(unique(rc_test_SD[!is.na(y) & party %in% c("D"), y]))
length(unique(rc_test_SD[!is.na(y) & party %in% c("R"), y]))
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
# )
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else if (length(unique(.SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(.SD[!is.na(y) & party %in% c("R"), y])))) {
cat("else if")
} else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
pls_work(.SD = rc_test_SD)
if (length(unique(.SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(.SD[!is.na(y) & party %in% c("R"), y])))) {
cat("else if")
}
if (length(unique(rc_test_SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(rc_test_SD[!is.na(y) & party %in% c("R"), y])))) {
cat("else if")
}
(length(unique(rc_test_SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(rc_test_SD[!is.na(y) & party %in% c("R"), y]))))
View(rc_test_SD)
(length(unique(rc_test_SD[!is.na(y) & party %in% c("D"), y]))
)
(length(unique(rc_test_SD[!is.na(y) & party %in% c("R"), y]))
)
devtools::document()
devtools::build()
devtools::install()
devtools::document()
devtools::build()
devtools::install()
library(partycalls)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
code_party_calls(h093)
debug(code_party_calls(h093))
library(partycalls)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
h112 <- pscl::readKH("inst/extdata/hou112kh.ord")
code_party_calls(h093)
devtools::document()
devtools::build()
devtools::install()
library(partycalls)
library(data.table)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
devtools::document()
devtools::build()
devtools::install()
library(partycalls)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
h112 <- pscl::readKH("inst/extdata/hou112kh.ord")
code_party_calls(h093)
devtools::document()
devtools::build()
devtools::install()
library(partycalls)
library(data.table)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
h111_test <- h111
h111_test <- pscl::dropRollCall(h111_test,
dropList = alist(dropLegis = state == "USA"))
h111_test <- emIRT::convertRC(h111_test, type = "binIRT")
h111_test$votes
DT_test <- CJ(vt = colnames(h111_test$votes), mc = rownames(h111_test$votes),
sorted = FALSE)
DT_test$y <- as.vector(h111_test$votes)
DT_test$party <- h111_test$legis.data$party
DT_test[y %in% c(0, 9), y:= NA]
DT_test[y == -1, y:= 0]
DT_test[, yea_perc := mean(y, na.rm = TRUE), by = vt]
noncall_test <- subset(DT_test, yea_perc < 0.65 & yea_perc > 0.35, select = vt)
noncall_test <- c(unique(noncall_test$vt))
noncall_test <-
as.numeric(c(gsub(pattern = "Vote ", replacement = "", noncall_test)))
rc_test_SD <- data.table(party = c("D", "D", "R", "D", "R"), y = c(1, 1, 1, 1, 1))
length(unique(rc_test_SD[!is.na(y) & party %in% c("D", "R"), y]))
length(unique(rc_test_SD[!is.na(y) & party %in% c("R"), y]))
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
# )
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else if (length(unique(.SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(.SD[!is.na(y) & party %in% c("R"), y])))) {
cat("else if")
} else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
pls_work(rc_test_SD)
rc_test_SD <- data.table(party = c("D", "D", "R", "D", "R"), y = c(1, 0, 0, 1, 1))
length(unique(rc_test_SD[!is.na(y) & party %in% c("D", "R"), y]))
length(unique(rc_test_SD[!is.na(y) & party %in% c("R"), y]))
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else if (length(unique(.SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(.SD[!is.na(y) & party %in% c("R"), y])))) {
cat("else if")
} else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
pls_work <- function(rc_test_SD)
}
pls_work <- function(rc_test_SD)
}
View(rc_test_SD)
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else { if (length(unique(.SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(.SD[!is.na(y) & party %in% c("R"), y])))) {
cat("else if") }
} else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else { if (length(unique(.SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(.SD[!is.na(y) & party %in% c("R"), y])))) {
cat("else if")
} else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
}
pls_work <- function(rc_test_SD)
}
rc_test_SD <- data.table(party = c("D", "D", "R", "D", "R"), y = c(1, 0, 0, 1, 1),
x = rnorm(5))
View(rc_test_SD)
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else { if (length(unique(.SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(.SD[!is.na(y) & party %in% c("R"), y])))) {
cat("else if")
} else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
}
pls_work <- function(rc_test_SD)
}
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else {
#   if (length(unique(.SD[!is.na(y) & party %in% c("D"), y])) |
#     (length(unique(.SD[!is.na(y) & party %in% c("R"), y])))) {
#   cat("else if")
# } else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
}
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else {
#   if (length(unique(.SD[!is.na(y) & party %in% c("D"), y])) |
#     (length(unique(.SD[!is.na(y) & party %in% c("R"), y])))) {
#   cat("else if")
# } else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
# }
pls_work(rc_test_SD)
if (length(unique(rc_test_SD[!is.na(y) & party %in% c("D"), y]))
{print("x")}
if (length(unique(rc_test_SD[!is.na(y) & party %in% c("D"), y])) {cat("b")}
if (length(unique(rc_test_SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(.SD[!is.na(y) & party %in% c("R"), y])))) {
cat("else if")
}
if (length(unique(rc_test_SD[!is.na(y) & party %in% c("D"), y])) |
(length(unique(rc_test_SD[!is.na(y) & party %in% c("R"), y])))) {
cat("else if")
}
pls_work(rc_test_SD)
(length(unique(rc_test_SD[!is.na(y) & party %in% c("D"), y])))
(length(unique(rc_test_SD[!is.na(y) & party %in% c("R"), y])))
mean(.SD$y[.SD$party == "R"], na.rm = TRUE)
mean(rc_test_SD$y[.SD$party == "R"], na.rm = TRUE)
mean(rc_test_SD$y[rc_test_SD$party == "R"], na.rm = TRUE)
mean(rc_test_SD[!is.na(y) & party %in% c("R"), y])
pls_work(rc_test_SD)
if (mean(rc_test_SD[!is.na(y) & party %in% c("R"), y]) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("R"), y])) == 0 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 0)
{
cat("else if")
}
if (mean(rc_test_SD[!is.na(y) & party %in% c("R"), y]) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("R"), y])) == 0 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 0)
{
cat("else if")
}
test_func <- function(){
if (mean(rc_test_SD[!is.na(y) & party %in% c("R"), y]) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("R"), y])) == 0 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 0)
{
cat("else if")
}
}
test_func()
test_func <- function(){
if (mean(rc_test_SD[!is.na(y) & party %in% c("R"), y]) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("R"), y])) == 0 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 0)
{
cat("else if")
} else {cat("else")}
}
test_func()
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else {
if (mean(rc_test_SD[!is.na(y) & party %in% c("R"), y]) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("R"), y])) == 0 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 0)
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
}
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else {
if (mean(rc_test_SD[!is.na(y) & party %in% c("R"), y]) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("R"), y])) == 0 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 0)
} else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
pls_work(rc_test_SD)
pls_work(rc_test_SD)
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else {
if (mean(rc_test_SD[!is.na(y) & party %in% c("R"), y]) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("R"), y])) == 0 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 0) {
cat("else if")
}
} else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else {
if (mean(rc_test_SD[!is.na(y) & party %in% c("R"), y]) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("R"), y])) == 0 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 0) {
cat("else if")
}
} else {
pls_work <- function(.SD)
{
if (mean(.SD[, y], na.rm = TRUE) %in% c(0:1, NaN)
| length(unique(.SD[!is.na(y) & party %in% c("D", "R"), party])) == 1L)
{
cat("if")
} else {
if (mean(rc_test_SD[!is.na(y) & party %in% c("R"), y]) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 1 |
(mean(rc_test_SD[!is.na(y) & party %in% c("R"), y])) == 0 |
(mean(rc_test_SD[!is.na(y) & party %in% c("D"), y])) == 0) {
cat("else if")
} else {
m <- lm(y ~ party + x, data = .SD)
suppressWarnings(summ <- summary(m)$coef["partyR", ])
cat("else")
}
}
}
pls_work(rc_test_SD)
devtools::document()
devtools::build()
devtools::install()
library(partycalls)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
h112 <- pscl::readKH("inst/extdata/hou112kh.ord")
code_party_calls(h093)
devtools::document()
devtools::build()
devtools::install()
devtools::document()
devtools::build()
devtools::install()
library(partycalls)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
h112 <- pscl::readKH("inst/extdata/hou112kh.ord")
code_party_calls(h093)
code_party_calls(h093)
library(partycalls)
options(stringsAsFactors = FALSE)
load("inst/extdata/houKHfiles001-111.rdata")
h112 <- pscl::readKH("inst/extdata/hou112kh.ord")
code_party_calls(h093)
